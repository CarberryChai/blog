<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      阿里OSS小试 | Carberry⚡
    </title>
    <meta name="description" content="Vite & Vue powered static site generator.">
    <link rel="stylesheet" href="/blog/assets/style.56d02f33.css">
    <link rel="modulepreload" href="/blog/assets/Home.6796e9d1.js">
    <link rel="modulepreload" href="/blog/assets/app.5d70980e.js">
    <link rel="modulepreload" href="/blog/assets/frontend_Having-ali-OSS-a-try.md.01865c30.lean.js">
    <link rel="modulepreload" href="/blog/assets/app.5d70980e.js">
    
    
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6e7c0b86><div class="sidebar-button" data-v-6e7c0b86><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/blog/" aria-label="Carberry⚡, back to home" data-v-6e7c0b86 data-v-76c79d52><!----> Carberry⚡</a><div class="flex-grow" data-v-6e7c0b86></div><div class="nav" data-v-6e7c0b86><nav class="nav-links" data-v-6e7c0b86 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/frontend/" data-v-99f6c566>前端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/backend/" data-v-99f6c566>后端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/tools/" data-v-99f6c566>开发工具 <!----></a></div></div><!--]--><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item isExternal" href="https://github.com/carberrychai/blog" target="_blank" rel="noopener noreferrer" data-v-99f6c566>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-99f6c566><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-58e261f2><nav class="nav-links nav" data-v-58e261f2 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/frontend/" data-v-99f6c566>前端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/backend/" data-v-99f6c566>后端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item" href="/blog/tools/" data-v-99f6c566>开发工具 <!----></a></div></div><!--]--><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-99f6c566><a class="item isExternal" href="https://github.com/carberrychai/blog" target="_blank" rel="noopener noreferrer" data-v-99f6c566>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-99f6c566><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-58e261f2><!--[--><li class="sidebar-link"><p class="sidebar-link-item">Basic</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/vue-common-question">Vue常见题目</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-common-question">前端常见问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/input-number-bugs">input number 那些坑</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/Promise">Promise</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/blog/frontend/Having-ali-OSS-a-try">阿里OSS小试</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#什么是oss">什么是OSS</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#下面来进行实践">下面来进行实践</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#小结">小结</a><!----></li></ul></li></ul></li><li class="sidebar-link"><p class="sidebar-link-item">Advanced</p><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-deploy">前端部署的一点经验</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-Design-Patterns">设计模式</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-d36a7fda><div class="container" data-v-d36a7fda><!--[--><!--]--><div class="content" data-v-d36a7fda><div><h1 id="阿里oss小试"><a class="header-anchor" href="#阿里oss小试" aria-hidden="true">#</a> 阿里OSS小试</h1><h2 id="什么是oss"><a class="header-anchor" href="#什么是oss" aria-hidden="true">#</a> 什么是OSS</h2><p>oss，全程Object Storage Service，是一种云存储服务。<a href="https://help.aliyun.com/document_detail/31817.html?spm=a2c4g.11174283.2.5.789f7da2cKAB17" target="_blank" rel="noopener noreferrer">点击查看文档详情</a></p><h3 id="下面来进行实践"><a class="header-anchor" href="#下面来进行实践" aria-hidden="true">#</a> 下面来进行实践</h3><p>1、首先当然是注册阿里云账号，购买OSS云存储服务，选标准存储就行，最便宜的，包年9块钱哟 😆</p><p>2、打开对象存储的控制台创建Bucket</p><p><img src="https://cdn.jsdelivr.net/gh/CarberryChai/oss@master/image/iShot2020-04-30%E4%B8%8B%E5%8D%8809.52.50-1588254876658.png" alt=""></p><p>bucket—翻译过来就是水桶，在这里可以理解为独一无二的名字，因为阿里云会把bucket和存储区域组合成一个域名，例如：bucket为xx-static，存储区域选择为华东杭州(oss-cn-hangzhou), 这样就会组合为<a href="https://xx-static.oss-cn-hangzhou.aliyuncs.com" target="_blank" rel="noopener noreferrer">https://xx-static.oss-cn-hangzhou.aliyuncs.com</a></p><p>3、hover右上角的头像，然后点击AccessKey管理，之后在跳转的页面点击开始使用子用户的AccessKey</p><p><img src="https://cdn.jsdelivr.net/gh/CarberryChai/oss@master/image/iShot2020-04-30%E4%B8%8B%E5%8D%8810.04.23-1588255474971.png" alt=""></p><p>4、创建子用户，这里其实就是创建一个用户组，给每个用户分发一定的权限，这样就可以使多人对同一个bucket存储进行管理</p><p><img src="https://cdn.jsdelivr.net/gh/CarberryChai/oss@master/image/iShot2020-04-30%E4%B8%8B%E5%8D%8810.11.42-1588256096968.png" alt=""></p><p>这里选择编程访问，确定之后选择你想分配给该用户的权限，我这里选择的使对对象存储的完全管理。之后会生成AccessKey ID和AccessKey Secret，记录下来，之后要用。</p><p>5、用nodejs编码上传文件</p><div class="language-javascript"><pre><code><span class="token string">&#39;use strict&#39;</span>
<span class="token keyword">const</span> <span class="token constant">OSS</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;ali-oss&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSS</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  region<span class="token operator">:</span> <span class="token string">&#39;oss-cn-hangzhou&#39;</span><span class="token punctuation">,</span>
  accessKeyId<span class="token operator">:</span> <span class="token string">&#39;xxxxxx-**************&#39;</span><span class="token punctuation">,</span>
  accessKeySecret<span class="token operator">:</span> <span class="token string">&#39;XXXXXXX-***********&#39;</span><span class="token punctuation">,</span>
  bucket<span class="token operator">:</span> <span class="token string">&#39;your-bucket&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> staticPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;../app/public/static&#39;</span><span class="token punctuation">)</span>
fs<span class="token punctuation">.</span>promises<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>staticPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">files</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> uploads <span class="token operator">=</span> files<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=&gt;</span>
    store<span class="token punctuation">.</span><span class="token function">putStream</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">images/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>staticPath <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>file<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>uploads<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">responses</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      responses<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;upload success 😊&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">errors</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;upload fail:&#39;</span><span class="token punctuation">,</span> errors<span class="token punctuation">,</span> <span class="token string">&#39;😢&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里要用到阿里云存储的包--ali-oss，创建一个OSS实例，传入一个配置对象，填写前面几步你得到的信息。</p><p>之后我们读取要上传的静态文件的文件夹，遍历所有文件，然后调用<code>store</code>的实例方法<code>putStream</code>，次方法接受两个参数。第一个就是在bucket上的路径，这个你自己定，第二个参数是对要上传的文件创建一个可读流，这里我们采用了流式上传，你也可以不采用用<code>put</code>方法。<code>store.putStream</code>返回一个promise, 之后我们用<code>Promise.all</code>把所有的上传操作一起执行。</p><h2 id="小结"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h2></div></div><footer class="page-footer" data-v-d36a7fda data-v-5a019cc9><div class="edit" data-v-5a019cc9><div class="edit-link" data-v-5a019cc9 data-v-fb0131f2><!----></div></div><div class="updated" data-v-5a019cc9><p class="last-updated" data-v-5a019cc9 data-v-52854a16><span class="prefix" data-v-52854a16>Last Updated:</span><span class="datetime" data-v-52854a16></span></p></div></footer><div class="next-and-prev-link" data-v-d36a7fda data-v-6683615c><div class="container" data-v-6683615c><div class="prev" data-v-6683615c><a class="link" href="/blog/frontend/Promise" data-v-6683615c><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-6683615c><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-6683615c>Promise</span></a></div><div class="next" data-v-6683615c><a class="link" href="/blog/frontend/FrontEnd-deploy" data-v-6683615c><span class="text" data-v-6683615c>前端部署的一点经验</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-6683615c><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"ac481ce4\",\"backend_leetcode.md\":\"dc2cfb05\",\"backend_const-determiner.md\":\"52cc7a8d\",\"backend_docker-client-deploy-mysql.md\":\"25fe1a8f\",\"backend_index.md\":\"6243537d\",\"frontend_frontend-design-patterns.md\":\"60d65912\",\"frontend_frontend-common-question.md\":\"eca7eb90\",\"frontend_frontend-deploy.md\":\"c6280f4b\",\"frontend_having-ali-oss-a-try.md\":\"01865c30\",\"frontend_note-mobile-keybord-bugs.md\":\"578c2c54\",\"frontend_promise.md\":\"bae4436f\",\"frontend_index.md\":\"3e2268ee\",\"frontend_input-number-bugs.md\":\"de9dfead\",\"frontend_vue-common-question.md\":\"4e07f744\",\"tools_git.md\":\"23b15fb4\",\"tools_index.md\":\"dfc75faf\"}")</script>
    <script type="module" async src="/blog/assets/app.5d70980e.js"></script>
  </body>
</html>