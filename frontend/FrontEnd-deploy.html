<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>
      前端部署的一点经验 | Carberry⚡
    </title>
    <meta name="description" content="Vite & Vue powered static site generator.">
    <link rel="stylesheet" href="/blog/assets/style.f567b133.css">
    <link rel="modulepreload" href="/blog/assets/framework.5c8a4622.js">
    <link rel="modulepreload" href="/blog/assets/frontend_FrontEnd-deploy.md.b559aec2.lean.js">
    <link rel="modulepreload" href="/blog/assets/app.e1e1fc8e.js">
    <style>img { border-radius: 10px }h1.title { margin-left: 0.5em }</style>
    
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-6e7c0b86><div class="sidebar-button" data-v-6e7c0b86><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/blog/" aria-label="Carberry⚡, back to home" data-v-6e7c0b86 data-v-00c3af85><!----> Carberry⚡</a><div class="flex-grow" data-v-6e7c0b86></div><div class="nav" data-v-6e7c0b86><nav class="nav-links" data-v-6e7c0b86 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/frontend/" data-v-98431d6e>前端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/backend/" data-v-98431d6e>后端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/tools/" data-v-98431d6e>开发工具 <!----></a></div></div><!--]--><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item isExternal" href="https://github.com/carberrychai/blog" target="_blank" rel="noopener noreferrer" data-v-98431d6e>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-98431d6e><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-58e261f2><nav class="nav-links nav" data-v-58e261f2 data-v-f465d38e><!--[--><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/frontend/" data-v-98431d6e>前端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/backend/" data-v-98431d6e>后端 <!----></a></div></div><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item" href="/blog/tools/" data-v-98431d6e>开发工具 <!----></a></div></div><!--]--><!----><div class="item" data-v-f465d38e><div class="nav-link" data-v-f465d38e data-v-98431d6e><a class="item isExternal" href="https://github.com/carberrychai/blog" target="_blank" rel="noopener noreferrer" data-v-98431d6e>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-98431d6e><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-58e261f2><!--[--><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>Basic</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/vue-common-question" data-v-58e261f2>Vue常见题目</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-common-question" data-v-58e261f2>前端常见问题</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/input-number-bugs" data-v-58e261f2>input number 那些坑</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/Promise" data-v-58e261f2>Promise</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/Having-ali-OSS-a-try" data-v-58e261f2>阿里OSS小试</a><!----></li></ul></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><p class="sidebar-link-item" data-v-58e261f2>Advanced</p><ul class="sidebar-links" data-v-58e261f2><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-deploy" data-v-58e261f2>前端部署的一点经验</a><!----></li><li class="sidebar-link" data-v-58e261f2 data-v-58e261f2><a class="sidebar-link-item" href="/blog/frontend/FrontEnd-Design-Patterns" data-v-58e261f2>设计模式</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-b109f666><div class="container" data-v-b109f666><!--[--><!--]--><div class="content" data-v-b109f666><div data-v-b109f666><h1 id="前端部署的一点经验"><a class="header-anchor" href="#前端部署的一点经验" aria-hidden="true">#</a> 前端部署的一点经验</h1><p>现在普遍采用的前后端分离的开发模式，这样的话前后端也会分开部署，加快开发进度。</p><p>下面以单页应用部署到 centos 7 的 nginx 服务器上为例，记录一下自己学习的过程。</p><h2 id="准备条件"><a class="header-anchor" href="#准备条件" aria-hidden="true">#</a> 准备条件</h2><ol><li>VMware Fusion （虚拟机容器）</li><li>Centos 7 Linux 系统镜像 （网址：<a href="http://mirrors.aliyun.com/centos/7/isos/x86_64/" target="_blank" rel="noopener noreferrer"></a>）</li></ol><p>具体的在虚拟机下安装 Centos 可以看<a href="https://mp.weixin.qq.com/s/WeZLtfrMdnISpX3v5WpJfA" target="_blank" rel="noopener noreferrer">这个教程</a></p><p>对于以 create-react-app 脚手架生成的工程来说</p><img src="https://cdn.jsdelivr.net/gh/CarberryChai/oss@master/image/image-20200612143335920-CzqrPH.png" alt="image-20200612143335920" style="zoom:50%;"><p>只需要<code>yarn build</code>就可以了，之后会在当前目录生成一个 build 文件夹，接下来我们压缩这个文件夹</p><div class="language-bash"><pre><code><span class="token function">tar</span> -vczf build.tar.gz build
</code></pre></div><p>在命令行运行这个命令会把 build 文件夹压缩成.tar.gz 文件</p><p>下面用<code>sftp</code>上传到我们的目标服务器，此处就是我本地的 192.168.0.101 主机，<code>sftp</code>和<code>ssh</code>命令很像</p><div class="language-bash"><pre><code><span class="token comment"># 以root用户连接到服务器，输入密码</span>
<span class="token function">sftp</span> root@192.168.0.101
<span class="token comment"># ls显示服务器文件列表</span>
<span class="token function">ls</span>
<span class="token comment"># lls显示本地文件列表</span>
lls
<span class="token comment"># cd 服务器上更改目录</span>
<span class="token builtin class-name">cd</span>
<span class="token comment"># lcd本地更改目录</span>
lcd
<span class="token comment"># put filename 把本地当前路径下的filename文件上传到服务器当前路径</span>
put build.tar.gz
<span class="token comment"># get filename 把服务器上文件下载到本地</span>
</code></pre></div><p>这里我们运行<code>put build.tar.gz</code>上传到/root 目录</p><h2 id="安装-nginx"><a class="header-anchor" href="#安装-nginx" aria-hidden="true">#</a> 安装 nginx</h2><p>下载 nginx 安装包，这里的是 nginx-1.19.8.tar.gz，用上面的方法用<code>sftp</code>命令上传到<code>root</code>目录</p><ol><li><p>在<code>/usr/local/</code>下创建<code>nginx</code>文件夹并进入</p><div class="language-bash"><pre><code><span class="token builtin class-name">cd</span> /usr/local
<span class="token function">mkdir</span> nginx
<span class="token builtin class-name">cd</span> nginx
</code></pre></div><ol start="2"><li>将<code>nginx</code>安装包解压到<code>/usr/local/nginx</code></li></ol><div class="language-bash"><pre><code><span class="token function">tar</span> zxvf /root/nginx-1.19.8.tar.gz -C ./
</code></pre></div></li></ol><p>解压完之后，/usr/local/nginx ⽬录中会出现⼀个 nginx-1.19.8 的⽬录</p><p>预先安装额外的依赖</p><div class="language-bash"><pre><code>yum -y <span class="token function">install</span> pcre-devel
yum -y <span class="token function">install</span> openssl openssl-devel
</code></pre></div><p>编译安装 nginx</p><div class="language-bash"><pre><code><span class="token builtin class-name">cd</span> nginx-1.19.8
./configure
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre></div><p>安装完成后，Nginx 的可执⾏⽂件位置位于</p><div class="language-bash"><pre><code>/usr/local/nginx/sbin/nginx
</code></pre></div><h2 id="启动-nginx"><a class="header-anchor" href="#启动-nginx" aria-hidden="true">#</a> 启动 nginx</h2><div class="language-bash"><pre><code><span class="token builtin class-name">cd</span> /usr/local/nginx/sbin
./nginx
</code></pre></div><p>这时候我们去浏览器输入地址：192.168.0.101 发现访问不了</p><p>我们的宿主机地址是：192.168.0.102</p><p>在宿主机命令行下 <code>ping 192.168.0.101</code>是通的</p><p>在服务器 ping 宿主机<code>ping 192.168.0.102</code>也是通</p><p>在服务器 ping 百度<code>ping baidu.com</code>也是通的</p><p>在服务器上运行 <code>curl localhost</code>可以返回 welcome to nginx 的 index.html</p><p>最好发现是防火墙的问题！！！</p><p>防火墙没有开启 80 端口，修改防火墙配置</p><div class="language-bash"><pre><code>firewall-cmd --permanent --add-port<span class="token operator">=</span><span class="token number">80</span>/tcp
firewall-cmd --reload
</code></pre></div><p>然后到宿主机的浏览器刷新 192.168.0.101 地址发现可以访了。</p><h2 id="单页应用的-nginx-配置修改"><a class="header-anchor" href="#单页应用的-nginx-配置修改" aria-hidden="true">#</a> 单页应用的 nginx 配置修改</h2><p>前后端分离的项目，前端本地开发一般都会在本地开启一个服务器，然后把 ajax 请求代理到后端服务器上去。</p><p><img src="https://cdn.jsdelivr.net/gh/CarberryChai/oss@master/image/image-20200612151311162-WnH9ZZ.png" alt="image-20200612151311162"></p><p>上图就是我们开发经常用到的 webpack devServer 的 proxy 设置，把以<code>/api</code>开头的请求代理到<code>target</code>服务上，并对路径进行重写，实际请求去掉了/api。同理部署到生产环境 nginx 服务器上时也需要进行相似的配置。</p><div class="language-nginx"><pre><code>
<span class="token keyword">server</span> <span class="token punctuation">{</span>
    <span class="token keyword">listen</span>              <span class="token number">80</span><span class="token punctuation">;</span>
    <span class="token keyword">server_name</span>         abc<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
    <span class="token keyword">access_log</span>  <span class="token string">&quot;pipe:rollback /data/log/nginx/access.log interval=1d baknum=7 maxsize=1G&quot;</span>  main<span class="token punctuation">;</span>

    <span class="token keyword">location</span> <span class="token operator">^</span><span class="token operator">~</span><span class="token operator">/</span>api<span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Real<span class="token operator">-</span>IP        <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span>  X<span class="token operator">-</span>Forwarded<span class="token operator">-</span>For  <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_set_header</span> X<span class="token operator">-</span>NginX<span class="token operator">-</span><span class="token keyword">Proxy</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token operator">/</span>order<span class="token operator">/</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">)</span>$ <span class="token operator">/</span>$<span class="token number">1</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">proxy_pass</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>通常单页应用如果用到路由的话，像 react-router 用 mode history 时，需要 nginx 这样配置</p><div class="language-nginx"><pre><code>  <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
       <span class="token keyword">root</span>   <span class="token operator">/</span><span class="token keyword">root</span><span class="token operator">/</span>build<span class="token punctuation">;</span>
       <span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span><span class="token operator">/</span> <span class="token operator">/</span><span class="token keyword">index</span><span class="token punctuation">.</span>html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></div></div><footer class="page-footer" data-v-b109f666 data-v-5a019cc9><div class="edit" data-v-5a019cc9><div class="edit-link" data-v-5a019cc9 data-v-fb0131f2><!----></div></div><div class="updated" data-v-5a019cc9><p class="last-updated" data-v-5a019cc9 data-v-52854a16><span class="prefix" data-v-52854a16>Last Updated:</span><span class="datetime" data-v-52854a16></span></p></div></footer><div class="next-and-prev-link" data-v-b109f666 data-v-6683615c><div class="container" data-v-6683615c><div class="prev" data-v-6683615c><a class="link" href="/blog/frontend/Having-ali-OSS-a-try" data-v-6683615c><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-6683615c><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-6683615c>阿里OSS小试</span></a></div><div class="next" data-v-6683615c><a class="link" href="/blog/frontend/FrontEnd-Design-Patterns" data-v-6683615c><span class="text" data-v-6683615c>设计模式</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-6683615c><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"0c36ba55\",\"backend_LeetCode.md\":\"00f183bc\",\"backend_const-determiner.md\":\"0601eeac\",\"backend_docker-client-deploy-mysql.md\":\"fba8297b\",\"backend_index.md\":\"27466e08\",\"tools_Git.md\":\"290319f1\",\"tools_index.md\":\"94dd1c9c\",\"frontend_FrontEnd-Design-Patterns.md\":\"a8892937\",\"frontend_FrontEnd-common-question.md\":\"a3d80186\",\"frontend_FrontEnd-deploy.md\":\"b559aec2\",\"frontend_Having-ali-OSS-a-try.md\":\"729f5fe0\",\"frontend_Note-mobile-keybord-bugs.md\":\"8c2761b8\",\"frontend_Promise.md\":\"8ebc49b9\",\"frontend_index.md\":\"9fe414f8\",\"frontend_input-number-bugs.md\":\"ba66380e\",\"frontend_vue-common-question.md\":\"d39053b7\"}")</script>
    <script type="module" async src="/blog/assets/app.e1e1fc8e.js"></script>
  </body>
</html>